<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{An Introduction to the openCyto package}
-->

An Introduction to **openCyto** package
=======================================


```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(out.extra='style="display:block; margin: auto"', fig.align="center")
```


Introduction
------------


The  **openCyto** package is designed to facilitate the automated gating methods in sequential way to mimic the manual gating scheme.


Traditional way of Gating (manually)
----------------------------
Biologists have to draw the gates for each individual sample on each 2D projections (2 channels) within `flowJo`. 
Or draw the 'template gate's on one sample and replicate it to other samples, then manually inspect the gate on each sample
to do the correction if necessary. Either way is time consuming and subjective, thus not suitable for the large data sets
generated by high-throughput flow Cytometers or the `cross-lab` data analysis.   

Here is one `xml` workspace (manual gating scheme) exported from `flowJo`.
```{r load-xml, eval=F}
library(flowWorkspace)
wsfile <- list.files(system.file("extdata", package="flowWorkspaceData"), pattern="manual.xml",full = TRUE)
wsfile
```
By using`flowWorkspace`package, We can load it into R,
```{r openWorkspace, eval=F}
ws <- openWorkspace(wsfile)
```
apply (`parseWorkspace`) the`manual gates`defined in`xml`to the raw`FSC`files,
```{r parseWorkspace, eval=F}
gs <- parseWorkspace(ws, name= "T-cell", subset =1)
```
and then visualize the`Gating Hierarchy` 
```{r plot-manual-GatingHierarchy, eval=F}
gh <- gs[[1]]
plot(gh)
```
and the`gates`: 
```{r plot-manual-gates, eval=F}
plotGate(gh, xbin = 32)
```   


Automated Gating methods
-----------------------------
`flowCore`,`flowStats`,`flowClust` and other packages provides many different gating methods to 
detect cell populations and draw the gates automatically. This package takes advantage of these tools
and set up the automated gating pipeline by following the manual gating scheme designed by the biologists and scientists.

  

Create gating templates
-----------------------------
First of all, we need to describe the gating hierarchy in a spread sheet (a plain text format).

```{r csv, eval = F}
library(openCyto)
library(data.table)
gtFile <- system.file("extdata/Cytotrol_Tcell.csv", package = "openCyto")
dtTemplate <- fread(gtFile)

#' #
gt_tcell <- gatingTemplate(gtFile)
plot(gt1)
getNodes(gs1[[1]])
Rm("cd3",gs1)
load(file.path(path,"data/fs_tcell.rda"))
gs1<-GatingSet(fs_tcell)
env1<-new.env(parent=emptyenv())
gating(gt1,gs1,env1,mc.cores=4,parallel_type = "multicore")
plotGate(gs1[[1]],xbin=32)
plot(env1$fct,"nonDebris",post=T)
plot(env1$fct,"cd3",post=T)
plot(env1$fct,"cd4+",post=T,channel="<B710-A>")
plot(env1$fct,"activated cd4",post=T,channel="<R660-A>")
plot(env1$fct,2,post=T)
plot(env1$fct,"lymph",post=T)
```









