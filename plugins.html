
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title></title>
    
    <meta name="author" content="">
    <meta name="description" content="OpenCyto : A Robust BioConductor Framework for Automated Flow Data Analysis" />

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/gh-slate/css/stylesheet.css" rel="stylesheet" type="text/css" media="all">

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    
<div id="header_wrap" class="outer">
  <header class="inner">
    <a id="forkme_banner" href="https://github.com/" target="_blank">View on GitHub</a>

    <h1 id="project_title"><a href="index.html" style="color:rgb(255,255,255)"><font color="FFFFFF">OpenCyto</font></a></h1>
<br>
    <h2 id="project_tagline">A Robust BioConductor Framework for Automated Flow Data Analysis
</h2>

    
    <section id="downloads">
      <a class="zip_download_link" href="https://github.com/openCyto/zipball/master">Download this project as a .zip file</a>
      <a class="tar_download_link" href="https://github.com/openCyto/tarball/master">Download this project as a tar.gz file</a>
    </section>
    
  </header>
</div>

    <div id="main_content_wrap" class="outer">
  <section id="main_content" class="inner">
    
<div class="page-header">
  <h1> </h1>
</div>

<div class="row-fluid">
  <div class="span12">
    <h1 id="plugins">Plugins</h1>

<p>OpenCyto supports some default gating routines out of the box, but you may have your own preferred clustering or automated gating algorithm that you’d like to plug into OpenCyto.</p>

<p>We support this through a plugin framework. The OpenCyto gating template puts together a function call from the <code>gating_method</code> and <code>gating_args</code> and calls a wrapper function that must have a specific function signature.</p>

<p>It’s the responsibility of this wrapper function to return a <code>filter</code> object, which is a <code>polygonGate</code>, <code>rectangleGate</code> <code>tmixFilter</code>, or other object that inherits from the <code>flowCore</code> <code>filter-class</code>. These are just instantiations of a gate, with specific coordinates.</p>

<h2 id="pluggin_in_your_gating_method">Pluggin in your gating method</h2>

<p>Let’s take an example (contributed by Jacob Frelinger at FHCRC). You have CyTOF data and you want to plugin a gating method for gating on the DNA-DNA channels to identify single-cells.</p>

<p>The gating function itself is shown below:</p>

<pre><code>
boundry &lt;-  function(xs) {
    # xs is a matrix
    # find the boundry events that are above a quantile and below a line
    
    # scale data so that it can be compaired to the results from qnorm
    cxs &lt;- scale(xs)
 
    # set a boundry level
    f &lt;- qnorm(0.95) 

    # and find the p(x) for that level
    pd &lt;- dmvnorm(c(f, f))[1]
 
    pxs &lt;- dmvnorm(x=cxs)
    
    # find those points who are above the boundy level
    idxs &lt;- (pxs &gt; pd)     
    
    # find points that are below the line with y=-1*x+b
    idxs2 &lt;- ((-1*cxs[,1]) + 1.96) &gt; cxs[,2]     
    
    # intersection of points below line and above threshold level
    pos_xs &lt;- xs[idxs&amp;idxs2,]
 
    # find the boundry points of the intersection of cells
    hpts &lt;- chull(pos_xs) 
    return(pos_xs[hpts,])
}
</code></pre>

<p>This returns the convex hull of a set of events that meet some criteria for this specific type of gate. The wrapper function, which is called by OpenCyto, should have the following signature:</p>

<pre><code>
.wrapper &lt;- function(fr, pp_res, xChannel=NA, yChannel=NA, filterId=&quot;&quot;,...){
	....
}
</code></pre>

<p>where <code>fr</code> is a flowFrame, <code>pp_res</code> is the output of any preprocessing function (may be NULL), <code>xChannel</code>, and <code>yChannel</code> are channel names, <code>filterId</code> is a gate name assigned by OpenCyto from the template, and the <code>...</code> are additional arguments. The signature of the wrapper must look exactly like this, and the name of the wrapper function must contain a <code>.</code> (dot) prefix, like <code>.wrapper</code> above.</p>

<p>The wrapper for the <code>boundary</code> gate above is the following:</p>

<pre><code>
.dnaGate &lt;- function(fr, pp_res, xChannel=NA, yChannel=NA, filterId=&quot;&quot;, ...){
    xs &lt;- exprs(fr[,c(xChannel, yChannel)]) # extract just the parameter values being inspected
    pnts &lt;- boundry(xs) # find the verticies of the gate
    return(polygonGate(boundaries=pnts, filterId=filterId))
}
</code></pre>

<p>You see that the signature is exactly as the template <code>.wrapper</code> function. The <code>.dnaGate</code> wrappe extracts the matrix of events from the <code>flowFrame</code>: <code>fr</code>, calls the <code>boundary</code> gate method, and constructs a <code>polygonGate</code> which inherits from the <code>filter-class</code> in <code>flowCore</code>, and returns it. That’s all. Your wrapper just needs to satisfy this contract. Take a flowFrame and some channels, and return a gate (filter).</p>

<h3 id="registering_your_gating_function">Registering your gating function</h3>

<p>After writing your wrapper, you make it visible to OpenCyto by calling <code>registerGatingFunction</code>.</p>

<pre><code>
registerGatingFunction(fun=.dnaGate,methodName=&#39;dnaGate&#39;, dep=&#39;mvtnorm&#39;)
</code></pre>

<p>This tells openCyto that <code>.dnaGate</code> is my wrapper, I will call it <code>dnaGate</code> in my template, and it depends on the <code>mvtnorm</code> package. If the dependency is not installed, the function will not be registered. This is useful if you want to distribute your plugins to other users.</p>
  </div>
</div>


  </section>
</div>

    <div id="footer_wrap" class="outer">
  <footer class="inner">
    <p> Follow <a href="http://www.twitter.com/OpenCyto">@OpenCyto</a> on twitter </p>
    <p class="copyright">OpenCyto maintained by <a href="https://github.com/RGLab">RGLab</a></p>
    <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
  </footer>
</div>


    
  </body>
</html>

